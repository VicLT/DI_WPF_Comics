<UserControl x:Class="Lamas_Victor_ComicsWPF.Views.OperacionesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Lamas_Victor_ComicsWPF.Views"
             xmlns:i="clr-namespace:Microsoft.Xaml.Behaviors;assembly=Microsoft.Xaml.Behaviors"
             mc:Ignorable="d" 
             d:DesignHeight="558" d:DesignWidth="1008">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadCommand}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    
    <UserControl.Resources>
        <Style TargetType="TextBox">
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.ModoOp, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="COMPRAR">
                    <Setter Property="IsEnabled" Value="False"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="1.5*" />
            <RowDefinition Height="0.75*" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="0.75*" />
            <RowDefinition Height="0.75*" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="2*" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="0.75*" />
            <ColumnDefinition Width="0.75*" />
            <ColumnDefinition Width="0.75*" />
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Row="0"
                   Grid.Column="0"
                   Grid.ColumnSpan="3"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Margin="5"
                   FontSize="18"
                   FontWeight="Bold"
                   Text="{Binding Titulo}"/>

        <TextBlock Grid.Row="1"
                   Grid.Column="0"
                   Grid.ColumnSpan="3"
                   Margin="5"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   FontSize="12"
                   Text="LISTADO CÓMICS (doble click para añadir uno al carrito)"/>

        <TextBox x:Name="txtBuscarCliente"
                 Grid.Row="5"
                 Grid.Column="0"
                 Grid.ColumnSpan="3"
                 Margin="5"
                 Padding="2"
                 Height="25"
                 TextAlignment="Center"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Center"
                 Text="{Binding Busqueda, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                 Foreground="Gray"
                 GotFocus="txtBuscarCliente_GotFocus"
                 LostFocus="txtBuscarCliente_LostFocus" />

        <DataGrid x:Name="DataGridComics"
                  Grid.Row="2"
                  Grid.RowSpan="2"
                  Grid.Column="0"
                  Grid.ColumnSpan="3"
                  Margin="5"
                  AutoGenerateColumns="False"
                  ItemsSource="{Binding ComicsConStock}"
                  CanUserAddRows="False"
                  SelectedItem="{Binding SelectedComic}">

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding SelectedComicChangedCommand}"  
                                   CommandParameter="{
                                        Binding ElementName=DataGridComics,
                                        Path=SelectedItem
                                   }"
                    />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <DataGrid.Columns>
                <DataGridTextColumn Header="ID"
                                    Binding="{Binding ComicId}"
                                    Width="0.5*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Cómic"
                                    Binding="{Binding Nombre}"
                                    Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Autor"
                                    Binding="{Binding Autor}"
                                    Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Editorial"
                                    Binding="{Binding Editorial}"
                                    Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="P. Compra"
                                    Binding="{Binding PCompra}"
                                    Width="0.9*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="P. Venta"
                                    Binding="{Binding PVenta}"
                                    Width="0.9*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Stock local"
                                    Binding="{Binding StockLocal}"
                                    Width="0.9*"
                                    IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <TextBlock Grid.Row="4"
                   Grid.Column="0"
                   Grid.ColumnSpan="3"
                   Margin="5"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   FontSize="12"
                   Text="LISTADO CLIENTES (click para añadir uno al resumen)"/>

        <DataGrid x:Name="DataGridClientes"
                  Grid.Row="6"
                  Grid.RowSpan="2"
                  Grid.Column="0"
                  Grid.ColumnSpan="3"
                  Margin="5"
                  AutoGenerateColumns="False"
                  ItemsSource="{Binding ClientesFiltrados}"
                  CanUserAddRows="False"
                  SelectedItem="{Binding SelectedCliente}">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Cliente ID"
                                    Binding="{Binding Path=ClienteId}"
                                    Visibility="Hidden"/>
                <DataGridTextColumn Header="Nombre"
                                    Binding="{Binding Path=Nombre}"
                                    Width="0.75*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Apellido"
                                    Binding="{Binding Path=Apellido}"
                                    Width="0.75*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="NIF"
                                    Binding="{Binding Path=Nif}"
                                    Width="0.75*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Dirección"
                                    Binding="{Binding Path=Direccion}"
                                    Width="*"
                                    IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="0"
                Grid.Column="3"
                Grid.RowSpan="8"
                Grid.ColumnSpan="6"
                BorderBrush="Red"
                BorderThickness="2"
                CornerRadius="5">
            
        </Border>
        
        <GroupBox Grid.Row="0"
                  Grid.Column="3"
                  Grid.ColumnSpan="3"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  Margin="5"
                  FontSize="12"
                  Content="Seleccione operación:"/>

        <Button Grid.Row="0"
                Grid.Column="3"
                Grid.ColumnSpan="3"
                Command="{Binding PrepararOperacionCommand}"
                CommandParameter="COMPRAR"
                HorizontalAlignment="Left"
                Margin="100,10,0,0"
                Content="COMPRAR"
                Width="100"
                Height="25"/>
        
        <Button Grid.Row="0"
                Grid.Column="3"
                Grid.ColumnSpan="3"
                Command="{Binding PrepararOperacionCommand}"
                CommandParameter="VENDER"
                Margin="0,10,100,0"
                HorizontalAlignment="Right"
                Content="VENDER"
                Width="100"
                Height="25"/>

        <TextBlock Grid.Row="1"
                   Grid.Column="3"
                   Grid.ColumnSpan="3"
                   Margin="5"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   FontSize="12"
                   Text="CARRITO (doble click para eliminar un producto)"/>

        <DataGrid x:Name="DataGridCarrito"
                  Grid.Row="2"
                  Grid.RowSpan="2"
                  Grid.Column="3"
                  Grid.ColumnSpan="3"
                  Margin="5"
                  AutoGenerateColumns="False"
                  ItemsSource="{Binding CarritoDataView}"
                  CanUserAddRows="False"
                  SelectedItem="{Binding SelectedProducto}">

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding SelectedProductoChangedCommand}"  
                           CommandParameter="{
                                Binding ElementName=DataGridCarrito,
                                Path=SelectedItem
                           }"
                    />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <DataGrid.Columns>
                <DataGridTextColumn Header="ID"
                                    Binding="{Binding ComicId}"
                                    Width="0.5*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Cómic"
                                    Binding="{Binding Nombre}"
                                    Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Cantidad"
                                    Binding="{Binding Cantidad}"
                                    Width="*"/>
                <DataGridTextColumn Header="Precio"
                                    Binding="{Binding Precio, StringFormat={}{0:F2}}"
                                    Width="*"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Descuento"
                                    Binding="{Binding Descuento, StringFormat={}{0:F2}}"
                                    Width="*"/>
                <DataGridTextColumn Header="Importe"
                                    Binding="{Binding Total, StringFormat={}{0:F2}}"
                                    Width="*"
                                    IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <Grid Grid.Row="4"
              Grid.RowSpan="4"
              Grid.Column="3"
              Grid.ColumnSpan="3"
              Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="1.25*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
                <RowDefinition Height="1.75*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.3*" />
                <ColumnDefinition Width="0.65*" />
                <ColumnDefinition Width="0.65*" />
                <ColumnDefinition Width="0.5*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <GroupBox Grid.Row="0"
                      Grid.RowSpan="5"
                      Grid.Column="0"
                      Grid.ColumnSpan="5"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      FontSize="12"
                      Content="RESUMEN"
                      FontWeight="Bold"/>

            <TextBlock Grid.Row="0"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Bottom"
                       Margin="20,0,10,0"
                       FontSize="12"
                       Text="Nombre:"/>

            <TextBox Grid.Row="0"
                     Grid.Column="1"
                     Grid.ColumnSpan="2"
                     Text="{Binding SelectedCliente.Nombre}"
                     HorizontalAlignment="Stretch"
                     Height="20"
                     VerticalAlignment="Bottom"
                     TextAlignment="Left"
                     IsReadOnly="True"/>

            <TextBlock Grid.Row="0"
                       Grid.Column="3"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Bottom"
                       Margin="20,0,10,0"
                       FontSize="12"
                       Text="NIF"/>

            <TextBox Grid.Row="0"
                     Grid.Column="4"
                     Text="{Binding SelectedCliente.Nif}"
                     Margin="0,0,20,0"
                     Height="20"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Bottom"
                     TextAlignment="Left"
                     IsReadOnly="True"/>

            <TextBlock Grid.Row="1"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Bottom"
                       Margin="20,0,10,0"
                       FontSize="12"
                       Text="Medio de pago:"/>

            <ComboBox Grid.Row="1"
                      Grid.Column="1"
                      Grid.ColumnSpan="2"
                      ItemsSource="{Binding MediosDePago}"
                      DisplayMemberPath="NombreCorto"
                      SelectedItem="{Binding SelectedMedioDePago}"
                      Height="20"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Bottom"/>

            <TextBlock Grid.Row="2"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Bottom"
                       Margin="20,0,10,0"
                       FontSize="12"
                       Text="TOTAL (sin IVA):"/>

            <TextBox Grid.Row="2"
                     Grid.Column="1"
                     Text="{Binding TotalSinIva, StringFormat={}{0:F2}}"
                     Height="20"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Bottom"
                     TextAlignment="Left"
                     IsReadOnly="True"
                     IsEnabled="True"/>

            <TextBlock Grid.Row="3"
                       Grid.Column="0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Bottom"
                       Margin="20,0,10,0"
                       FontSize="12"
                       Text="TOTAL (+21% IVA):"/>

            <TextBox Grid.Row="3"
                     Grid.Column="1"
                     Height="20"
                     Text="{Binding TotalConIva, StringFormat={}{0:F2}}"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Bottom"
                     TextAlignment="Left"
                     IsReadOnly="True"
                     IsEnabled="True"/>

            <Button Grid.Row="4"
                    Grid.Column="0"
                    Grid.ColumnSpan="5"
                    Command="{Binding ConfirmarOperacionCommand}"
                    Margin="20,0,20,0"
                    HorizontalAlignment="Stretch"
                    Content="CONFIRMAR"
                    FontSize="14"
                    FontWeight="Bold"
                    Height="30"/>
        </Grid>
    </Grid>
</UserControl>
